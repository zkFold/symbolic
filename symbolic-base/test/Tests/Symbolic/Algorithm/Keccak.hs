{-# LANGUAGE AllowAmbiguousTypes #-}
{-# LANGUAGE TypeApplications    #-}
{-# LANGUAGE TypeOperators       #-}

module Tests.Symbolic.Algorithm.Keccak (specKeccak) where

import           Control.Monad                          (forM, forM_)
import           Data.Binary                            (Binary)
import           Data.Bits                              (shiftR)
import qualified Data.ByteString                        as Bytes
import           Data.Constraint
import           Data.Constraint.Nat
import           Data.Constraint.Unsafe
import           Data.Function                          (($))
import           Data.Functor                           ((<$>))
import           Data.List                              (isPrefixOf, isSuffixOf, take, (++))
import           Data.List.Split                        (splitOn)
import           Data.Proxy                             (Proxy (..))
import           GHC.Generics                           (U1)
import           GHC.TypeLits                           (KnownSymbol, SomeNat (..), Symbol, symbolVal)
import           GHC.TypeNats                           (someNatVal, withKnownNat)
import           Prelude                                (Functor (..), String, otherwise, pure, read, (<>), (==))
import qualified Prelude                                as Haskell
import           System.Directory                       (listDirectory)
import           System.Environment                     (lookupEnv)
import           System.FilePath.Posix
import           System.IO                              (IO)
import           Test.Hspec                             (Spec, describe, it, runIO, shouldBe)
import qualified Tests.Symbolic.ArithmeticCircuit       as AC (it)
import           Text.Regex.TDFA

import           ZkFold.Algebra.Class
import           ZkFold.Algebra.EllipticCurve.BLS12_381 (BLS12_381_Scalar)
import           ZkFold.Algebra.Field                   (Zp)
import           ZkFold.Algebra.Number
import           ZkFold.Data.Vector                     (Vector)
import           ZkFold.Prelude                         (chooseNatural)
import           ZkFold.Symbolic.Algorithm.Hash.Keccak  (AlgorithmSetup, Keccak, Rate, ResultSizeInBits, keccak,
                                                         padding, toBlocks)
import           ZkFold.Symbolic.Class                  (Arithmetic, Symbolic)
import           ZkFold.Symbolic.Compiler               (ArithmeticCircuit, exec)
import           ZkFold.Symbolic.Data.Bool
import           ZkFold.Symbolic.Data.ByteString
import           ZkFold.Symbolic.Data.VarByteString     (fromNatural)
import           ZkFold.Symbolic.Interpreter            (Interpreter (Interpreter))

withConstraints ::
  forall n {r}.
  KnownNat n =>
  ( ( Mod (n * 8) 8 ~ 0
    , KnownNat (n * 8)
    ) =>
    r
  ) ->
  r
withConstraints = withDict (withConstraints' @n)

withConstraints' ::
  forall n.
  KnownNat n
    :- ( Mod (n * 8) 8 ~ 0
       , KnownNat (n * 8)
       )
withConstraints' =
  Sub
    $ withKnownNat @(n * 8)
      (unsafeSNat (value @n * 8))
    $ withDict
      (unsafeAxiom @(Mod (n * 8) 8 ~ 0))
      Dict

{- | These test files are provided by the Computer Security Resource Center.
Passing these tests is a requirement for having an implementation of a hashing function officially validated.
https://csrc.nist.gov/Projects/Cryptographic-Algorithm-Validation-Program/Secure-Hashing#shavs
-}
dataDir :: FilePath
dataDir = "test/data/sha-3bytetestvectors/"

getTestFiles :: forall (algorithm :: Symbol). KnownSymbol algorithm => IO [FilePath]
getTestFiles = Haskell.filter isAlgoFile <$> listDirectory dataDir
 where
  -- TODO: Is this filter needed?
  isAlgoFile :: String -> Haskell.Bool
  isAlgoFile s = (algorithm `isPrefixOf` s) && not ((algorithm <> "_") `isPrefixOf` s) && (".rsp" `isSuffixOf` s)

  algorithm :: String
  algorithm = (\c -> if c == '-' then '_' else c) <$> symbolVal (Proxy @algorithm)

readRSP :: FilePath -> IO [(Natural, Natural, Natural)]
readRSP path = do
  fullTests <- lookupEnv "FULL_SHA3"
  contents <- Haskell.readFile path
  let parts = Haskell.filter (\s -> take 3 s == "Len") $ splitOn "\r\n\r\n" contents
  case fullTests of
    Haskell.Nothing -> pure $ take 20 $ readTestCase <$> parts
    _               -> pure $ readTestCase <$> parts

readTestCase :: String -> (Natural, Natural, Natural)
readTestCase s = (numBytes, msg, hash)
 where
  numBytes :: Natural
  numBytes = read numBytesS

  msg :: Natural
  msg = read ("0x" ++ msgS)

  hash :: Natural
  hash = read ("0x" ++ hashS)

  numBytesS :: String
  numBytesS = case s =~ ("Len = ([0-9]+)" :: String) of
    (_ :: String, _ :: String, _ :: String, [x]) -> x
    _                                            -> Haskell.error "unreachable"

  msgS :: String
  msgS = case s =~ ("Msg = ([a-f0-9]+)" :: String) of
    (_ :: String, _ :: String, _ :: String, [x]) -> x
    _                                            -> Haskell.error "unreachable"

  hashS :: String
  hashS = case s =~ ("MD = ([a-f0-9]+)" :: String) of
    (_ :: String, _ :: String, _ :: String, [x]) -> x
    _                                            -> Haskell.error "unreachable"

testAlgorithm ::
  forall (algorithm :: Symbol) element.
  KnownSymbol algorithm =>
  AlgorithmSetup algorithm (Interpreter element) =>
  -- TODO: Why do I need to say symbolic constraint here? Did SHA2 also required it?
  Symbolic (Interpreter element) =>
  -- TODO: Is this constraint needed?
  ToConstant (ByteString (ResultSizeInBits (Rate algorithm)) (Interpreter element)) =>
  FilePath ->
  Spec
testAlgorithm file = do
  testCases <- runIO (readRSP $ dataDir </> file)
  describe description $
    forM_ testCases $ \(numBytes, input, hash) -> do
      let bitMsgN = "calculates hash on a message of " <> Haskell.show numBytes <> " bytes (input is Natural)"
      case someNatVal numBytes of
        SomeNat (_ :: Proxy bytes) ->
          it bitMsgN $
            ( withConstraints @bytes $
                let inBS = fromConstant @Natural @(ByteString (bytes * 8) (Interpreter element)) input
                 in toConstant $ keccak @algorithm @(Interpreter element) @(bytes * 8) inBS
            )
              `shouldBe` hash
 where
  description :: String
  description = "Testing " <> symbolVal (Proxy @algorithm) <> " on " <> file

type Element = Zp BLS12_381_Scalar

-- TODO: Following is not a property based test.
-- TODO: Refactor constants and abstract `toConstant ...` portion.

specKeccak :: Spec
specKeccak = do
  describe "Keccak" $
    describe "padding" $ do
      it "padding result for empty string" $ do
        let paddedMsg = (padding @"Keccak256" @(Interpreter Element) @0 (fromConstant ("" :: Bytes.ByteString)))
            paddedMsgBlks = concat $ toBlocks @"Keccak256" @(Interpreter Element) @0 paddedMsg
        toConstant paddedMsg `shouldBe` 12953744211667879574559702190010707651171625584905095574841686913755541732351702201085464556891975967691972983316275962328947759192690782519488857596207264634977115153700247127325882095493965845839345131422255684387968478939180332711558614761546211605811843616790961251349338535374752162059924960553344400851693295429983666304
        (toConstant paddedMsgBlks) `shouldBe` 179769313486231590772930519078902473361797697894230657273430081157732675805500963132708477322407536021120113879871393357658789768814416622492847430639474124377767893424865485276302219601246094119453082952085005768838150682342462881473913110540827237163350510684586298239947245938479716304844579701661078913024
        Haskell.print $ keccak @"Keccak256" @(Interpreter Element) @0 (fromConstant ("" :: Bytes.ByteString))
      it "padding result for single character" $ do
        let paddedMsg = padding @"Keccak256" @(Interpreter Element) @8 (fromConstant ("a" :: Bytes.ByteString))
            paddedMsgBlks = concat $ toBlocks @"Keccak256" @(Interpreter Element) @8 paddedMsg
        toConstant (paddedMsg) `shouldBe` 1256563789095111146386879236267718371490410070898235306289232855973794405623007112342013052114447028147245176151144847548885780093875352352759635940182089854220260549264993112940951679989850210350501787689878419571900082958971348446195840157708894815652834033342851331073273921285004767345445767755551568384180076583643688992896
        toConstant (paddedMsgBlks) `shouldBe` 63458567660639751542844473234852573096714587356663422017520818648679634559341839985846092494809860215455400199594601855253552788391489067739975143015734365905352066378977516302534683519239871224166938282086007036399867190866889397160291328020912014718662730271658963278701377816283339855606890007729387975213056
        Haskell.print $ keccak @"Keccak256" @(Interpreter Element) @8 (fromConstant ("a" :: Bytes.ByteString))
      it "padding result for 2 different characters" $ do
        let paddedMsg = padding @"Keccak256" @(Interpreter Element) @16 (fromConstant ("ab" :: Bytes.ByteString))
            paddedMsgBlks = concat $ toBlocks @"Keccak256" @(Interpreter Element) @16 paddedMsg
        toConstant (paddedMsg) `shouldBe` 1261472241396263924302452983284389146379044485237681537954425171817442040019971983874599040599269086850945352620485257109623615172367052947887603268073426142713308442035559492288377272489810562734683435298042007148352817658029830276063792658324945186026477916285596844085278897540024317217888915285846691698180780007798547153024
        toConstant (paddedMsgBlks) `shouldBe` 16308851888784416146511029621357111285855648950662499458502850392710666081750852876362445771166134075372037851295812676800163066616612690409173611755043732037675481059397221689751413664444646904610903138496103808354765868052790575070194871301374387782696321679816353562626254098784818342890968370803211274807148544
        Haskell.print $ keccak @"Keccak256" @(Interpreter Element) @16 (fromConstant ("ab" :: Bytes.ByteString))
      it "padding result for 10000 characters" $
        toConstant (padding @"Keccak256" @(Interpreter Element) @80000 (fromConstant (Bytes.replicate 10000 97))) `shouldBe` 128009573995024472076460612006174618690816983811721330397921353057817909217018687268609146111033414464760630684277916729388106119190785486756670617379457737774480911710618893651482986725242303322044760107455707727192505616615486276771607778664119617300971551676022596670656458237235745293325345723395093708935070316600218262054362830706479433264502978245964367902088238470549651685914639476552895860122662901792882387036830673953753049256538823204811565564211648086422049975488999206285826394414152552559084639537529944865203664858259284923768517456134039400920667324155692802810850037487353740717840505341666464479462204603743491862958831060260190432307534380798037147715722898464230243614858624110418932387437042041017980406654263532938955436480420466751906771833611149927765847030356912418797601909339724223995075932736588229520380857456100801006795751922689818297896853871846720625765105470069477723226910410577234639022089282081204888327588591544401898754975761636751031532086288232620834223418843654771202060447690873894684523451661908904677092559580063381324248441179242231907212842417323186983369564515530302945754631372525123715316176472591788535334823794796761592798416883518893822929681991069200694238187600872665869192998408816578777538186278321547335394542480845003990399693696393994173868525907415846823991578774295687663862190370599403336074926084621439239896263773307133328656945613089941811213790542653355023873211406248646730497409321834990162031799035508013115550614420840865506375994396005177802222394779901454493123059669401326685201738744162254125471695329294395786442663815826002997896479075365852222499506197711262081732143138391297132027347883625435205946987665576172740402653340574747120414013832697507500001820318585948501756355726651588009022452001532899898443722404133534553720004541751105105168776018678592621201119594335519412561653801983742187288421438562629491296466578324996527045152211980965479613425232587992888145917467514162962432687545532101535040444809625187724382886289466762872883981011313260661884516543935440337581574206852404828661386601343415645350965389540777149780334349432172899754228734955251860781378479098790902312798685223804650661192644247033424271999454226859621608711210905458711787060099020442688616147498792915295319531960515334750112580455633958165207757406591597944257001537678882043760510964285452133240756716568087281396451517652971781530519907451988464219870994166322177944869002511057587382472973909630752896012793015632567199277497213944069280171684106110589852285723686126958903752538025684530599798775147286481052257885292050674411619871257832546855020501364576375255159921550130455455174706544660119705092969583237022760752563400977230446737386577062590156235813844233801161322591150766073474712176868161441076370325246003518002234122434299377533548830316787399398842550203983630370731735302318948136297537874309610708002565818913946192203910858186115335356332863665966092136283347716333457973110099155294779892337821482771496148827780706967330699565377817397402700223329655034302929950362538187715540917929161822321345389121262736174587368056983430882488662540971871344739703701136838350223252303521859089296144551037975335629702385264595896510847129776976648886915048182002255601962529922697772234597013902890754057954968024070748103449175768996444620491282705259570612804431702028206202098136074745469933627730107175412221011936336048274078360248962066101577722937542886622827383391042630918670903647684295568493218445656526040261895923972268686462050365100749540261407899686275507753457591117968627051760174025450275556085038064879255385083618911359636486442953945452886019463081009247068976067648082650993854868097652471328459289359176492594928573137751399639148584765518626962567505725190644337341051663088175434801400268248432529746668248730357881096441918890645716391149092476957709757087892037143162614268988261928101558046471442451084478751886134365278726634168096260613540180523155301511487560795805444392825715705322810142911701523367928230706796420287297642773709777471703303446645776212205291999521482806318353600426356015753003777822561511720798766100122860066604209125970594480914448430033730619488891352993430001683098159783339324950070769096257559409312846132496229602434300171501024967560666907787605497772022826583977265188744782628963779881063756485430315495235912244450382953675599590643444714175763683666152866856013671270778036343782812825541934855732936998243546426824692802785912744506793521618787370249568211500263182826800140363886530041420375771027835960842030442367445536842056606365517625576025102049677049154416282054636518125819650789019147548871406360086839268412554449407480635979301124192462644954105095497027872501226417477939279877608036718865959400708311993509131938482173669137227554492947512001605590054777642328332715982152822190062052596353449260024185671984265151835148837250676057947549141244834469824961913090282642389189726575052395634812284648663745490903660203431791893378233290152630203671269974152248262511188552282048268350318617376663936928194452447948471811702377980668103554867003144309668094780346821690889003146244025872976261366883930532777066607682683589440347828906162604992022392607881843631982722226735419034717141817274257646533212105279836430494558430056769801960697409863573715183171774202103364685611446026855112023296083006384058814918194963059803935303945872237121330132648943699457534318471751043470233749334837282333517317111823958005748155284733025182311998832889159952682536579913423581566495832660328789299087412387873319877299437573874354948436904288673701050965854566870214378145511353487781620311531024739763919253398579408034735769332456564748752733718785420063222065478239333218002724834886767204287628792530978722137886259736389036191136233592194193327400488620060651061207813790035930690700912977228797863685737794314309815964736214804989920386701080936175052005444435439063294266273216428307717441067648689302116791122442325839329557401457880319133288473858699707977848459120496956122956127704605201646983084555536271334620835365157126682527006926473119119719306637121219858352478448067159983445542625528177991250553854295739407999464681765724193444026429972640801270039749835588623205536520133417528783435407407981685496177382641038597785888902916361431208335229972667827537592560660772800624418656192930572837714484994964410003778467184784843077029208516664980555275302934786574875349805461666003464500725755038960534208971204647387180369108583714730213977042198429023692339645725179666481058768151132188353170725781733809746919425028784276856801721729383968931630819706319802452795860963450314634946164428102653197670458870432142047143357457680110114651427282881566066244893580229976272612400879753073210390727114230930271874736295043081393075347374937191020596170370825221029821597488660001800676268222328712906332172317483258428912791686802777928065134040540520418610897298857732085263274012013891201729540537823532740317836334704076615137446655185687543662497721800573208666619238462445815144989159784987694040763463747215418492423004984985164468234118989135034764040729617751280214693811629298904988004841374880452263445065227499676662984783496442776148404173681827646084395824914532275509368171032092850529193903799424172518873187686380281881078154926296346348215033060358902734631095741516457471209704593863701763259392478977238426079001418927358589624373425652847748215165652524871841953456694502292212309638222980280350116779031352826282100754780345660139343225638445936233870699979843185291972292146225892538552169223066367310116065135151903685801493217935670726797518781774827129138058482423864417928198932681698328385963578951233099323936836705755221391370140131867708093671777914451991397328598876617927038807294823348805877959343218636408884705642997735912315380713012522184888749827360527752056375966755475692825448776311691816001081247212331229639821071981612451531594261916778986123333917879344192787794128153194875969420384166537049348931341474920650724933788340905873698255162535656844078250717645687489089924645684792391920578247137333628688368432570206483185837794128490478510984600091299477920954702364261483394412891600272661525173025302812272895465456085836337700758583974294610623824877582534788187522969396344866490838254360018178403281604450261073912012284575872108289646351898817286315666523148647021902511965198600022712735642479379330543683801555669642213285110308568470038079185116439559001271469246055452014266606152650509424249067774531898320861494302542424958120010693647989677811456933770784727625366414584051506130750600838869565268714502781804625195784191591973322215648591138772960279793209118472732728621419702883447117169396186617464669554537979219903851500721365915568181801995815632925967128885645876764563639585356340609617272361477650395124452430323422277960898476672385559715958433085202687198470091331045018023444664633858890884613990269910605398060743650192321596050447300724089598509100673751735162861403943323203935963402258991230823149445852859449684301936751535115978866088419155947282614802658227921309619459844729797152787855110617947353849491053532417000350599527141881167613701640074218680180686430494260180657748031042372423351262045273308971935558350231069024199324790968313414636055722450374486428534060567926939466122493631253623360479046114905045798462286950045288011829157430551039819494381085768985774003207739609103321023864315761044067363135327586971640495771791137046109819707126591262480150676197824179793402922821060224223348839849254298742577458702737218401316046552370624854644099646520674455718799124167545366112047302622616614951263190938446151137759101637812373729076651847352272995508571554633019658072702224354216411443328135533648289105137338261972245345519742424828424561402799229286794641243414016618937677120679148535225705728406896746818938482900095546020206157682699371467989681135294994710761071425672928932897764100431142316875003641814495464420334617177243099146130467941789590022213369442838185440107471607535851701789439192799508051669978033538930995484890864464867136956917462015550795818856649563467978822728803361855127738491776801330422430278189651651917949976163868928112416785529378824313402766822840707018240055994973538054285615523535646611812613922159570372754390682556659565476938599463421386534699213751190697689097654536354744681696057379721419479170821656719869140966458347495204328949418643596168655754758010125488643100192250939458357719389779983661491503012690961266963499481356967333478661310761614452563815572765294961417138168569625196332425994323772772032251670804185638910370344600096990030571757613086131183258464218718427273998846770591408269342795652997052463835501243415769158462039546729563408986325400930209495266258387698354851547144133613600203862787611441608974562309709609570150035267695684510451318525991026010391049004716719425887966796664573394292540522952941292123388750803094372289936637332215316907322914932876377405350162787811229682506882388795520680452403344516131553919693666204019422548766808781760641873445132941187841529416084270508452995700875544203070914077506177469629909171109910277736360974663728255303989528935232314845426486325281165278765663326159485537409766634143126121296439660360241150821352236764132394685154495794092851753875703193420932646313912237559407789348317139872529706563649520972415729438318218473314973558290191530708059917059195045826242345207957882854718882263595443349543720766267211718720583993145808326591591027416306705196575528894056391617242638962668908088699526623031666553993461387501012242026210409640901406475505668367967232588297727861072883333900250469168809235252534666098612636137130305657051186644542082561435744680660749153416522961902080196428888826241844106940989837788518739075578942410897971321647618903596038158395054334528806349847630720591675824627049056504760062066161853259338056160913492536530442560254125415809900457091928106963495110205223336170349835037497059596168784608010592837382789619797692029300891922099939611991710602864512555937769089066174678622862894852362840717825261677864769206441380260066373933643760094584719911248035275751365700684953971668789580653009434006574725017881104571827389046160912279288205464843047041076253700549273810567689529795431427860652057166106472549642122962959162030491951260057446966088952673520758415281462487815257113043092246698089889384873803066083508483665623376678140633071828227696329997704476984998448218370077895596977978600844344325848108911398347600548655347801354441235159381185535928631427882040517484753117088379718347562206360852099844346224406285003228870889588835161836967284506009703822245115952513130306523196327130738018891032345386912705259186683465995237510282590315247538139753306718147474842304587844475672506300255890362796435212039897909516799287664906950983279457935674261890257075599011027882423420176895293654726375326385526447177841692985740609358697340964650185076840110527262874219866357666142623145774162618749353987998903259950615595135173788675559399098535114824411199332533106639583530634175326404147552104980760593975833528585691598032064706675012903719230755879981269446791407665694246962923253309437641115511034538110759180180807722788933720228513272240742158030487407835782470778271234211460156453831594758412048415557168874835274449769134238540222045871672184743103839572418823723018753640206182645582978533151449002555723386684470650391077312267788747304322000139330909182176668109791699050917933697063126274826849144622330942190552048443816312860607908712953432711930385799007862889602561608130023509065342565434930844845311532704919996814488780196989981412473249546275284155680780552889935056403441333015565268048752917014449140641050105047214739380593104653010845886688673115488253539795895005209525141214600494472705777757419992748486967238278276822584438483214736181134906683659225757571797412251395868328159040011100325582551215541670025320394332637646558512294459645404088445685676378030207991289215544170260734686791914875490064585759772173059108372175866073025826734244873744494832399330598816153344283018320864235489743529192517490627620415920197760962559770063935151007240086643066962194989528618575098907055757704287343260358196136858644772392190224300863443736609081359271247438236579845027920368742370873893924960497083688082791628895872666153096884587207363824860829545307231704142260916528490557306541433733550591797095138307855887426306012821975273861298176483288943312592940462480834020086362369678748341525890865338350700748411390370183981885289441168993647524501380096253127483182011623726387115129873400310518901664831035934984696468658463617278202612178785973990227343227855096884678354594939937985972098912680244888129305830031919878905190994380926223164963506307530108612156784577717017347847821985583791121172229169710606580080827075378157145860629327095063008213541919623115019853587877559971075362860585705150759877988244036178480500281779539834952008119681856003634880254738459298486188255669821637143685448692923599363671328385747235722385733184897840947391318745726987271305813784803639719443982516491741709963834419106165852019473331951424358168779001950987847428318653475854736820815528344944784139488751174399055430391618012030728225978493088526785462216686267261677490820261625306926309557842209907281734518760559589201352538137153582916270166555117734869878475617429936504636125469414247735950825062979315401176502937072794336065722008627612144372840059832575587634864599859397431630028258228427089128919918117594849200022562092470792006591060444383158815984998038372497590518948289310591375922369685165205420771147938266729939133278943303368548687868226608518069236040728859569671835829325796376209680437427871162949502241039378241756293230262488600316297439526380588160662471273570394930864440933100403661777156776851993001067955596491297215574244671547126567558414007337997697973712120965523163480520267050302966479247988275745418011242302640490875921593422787051106494681522468550477208068808477574266208711517963650323010425657099692915503568764064811427652214580497927746536017135047420851328347646779488416224035156187678834420323476709859106020132615422546182490699144882291933156215679893566297605846823845233387363804490027866183882005835731694091785394881975186029490265553946984733315404047409991292905382974159833366470384868465486492812968078741789160733926858756352174180773932016867868962861435911202388024914605303548444855789773694725160247479129466969925756273637971236901968176399903152703885397361016633166938565777688035623216036494452297312548412119239899386514113374458775267412413233363903839118212069859533375621156624709073004005870464626376405678334948950481662435988156530796288226133248293186090649363435816160056523982847164868120756259453484205786353126559630542939257952816325949785625068408895462050994997012594689608581084258785514344104647035512034928756515442349754608094004014513189178998179207000099799136834938043709140966695283362846913616665730882348014881401242346190505922834673834102626436919964188149035455096309314750764860333458556892714676149598465218416621005830156061783606139361186907256506366112687001877091522204084359204046812327653659618906479898023556297869658423644243893646921576708288045862131610252790752431839776164761890026326067566015916891172139570307926678350233143921112499150111659505991028561769768424497354635811360296509234180774165324222852456722429821150217446127905942207272559883407665063666023932715362934583888614305276426827135448975973269157112090017357657645109672044631459533159740161794944938427998565015051586659751056870248950468051912863809399370468221696128169124648057294525810403997815721073394840232242512326773280017133790477129248482469788971356457414426379686185979097271954817476338625588146273625437055183879614540563260780603520088093051469679058819647893220576585930846493999250747363808737334627325383314932541983370494221803552506046799974777365153790397049938623582839663270155202921509886920539056518837071302013259667242435358533889745555411134543319674027570901519493064773211497159284248016519714281821403446998152953116749208707215599068456013367400421902021597223445450184808117242243572439888063584016277746131112931960413840869297855487160336562629445702512113146852961507345705689320612957693607170637337989254095525745165037857735336090356391167303527522854780117091348762822730672030722243982929749337245978270269478348885999382046367650317184933080269599735839330960133566197528209115854484135078231581250139564807812597538203577623426586193852630844563782367329120277321571201406223818952214410113494092184890383174596500437641931110092800175336566819484212312750132126992733317885989095107616106529888092854254824072501032853371995828072353055266662138728813404490612557142834801993494445818108521348827999535608319077858243555694126804180540893110258698746689188792334115136066627570338976162538318229261535975590130165465286184695408673544340594240629313014380792006320717693322034062375051234087439894966595694560640631752968645516819667896245763534701398257337978455550016178015955247438102027893836823717763329431811660918204562817478526138565012864438030506663319106836040902980451591991545548723424723092625224288310407677334012310619731294515246810635333983097565162187828713169064084081658440396508503646415287358662839580530982321078886965737279693759440496968235098807853198444308553387096323573701612940971948388592971421463539945191295672480486668577166104438743510819015071658428879229074060460742764632318337669467719790454166440716247225403046876302741422455976301150835957910934196703362390149458028581117809522554834245760843783110812121557231644009200290492791092752336197813043700554547407032427420533500233291251367461791252576780761682481243650090137880688895069492468983876173121662375478962116155950765194348181195111044508649233219446902350219653858884872037494085872110817946672095235709996126050313591141661263362435292316955356253013445960501634138640803696774743587208028187515432543274335173894832077364932494391092817915838664349934863229881819172621006157780510122051530908201083229532226884077851533808924049302695423120132152883841089668030582456848738120177594232712774901905763042511709364802716777277750842433801555979581777995332845375154199127791752210556205504448933438622237953041489074488094662945100204778352526604081194912444947005072510323796399212307684015093945250966854634268337869563428999240012268790541617499451203967760248357859899001898528708726604285018870648073795119316790227610643634391590509118108280031847296309611508128828470957645054017188854845462885761204580789412056348868946847120157673527870467220999773765221808970165620839416542272057203362610976092518629825169035945103512538524033237889185429184864314883228251412563439011611952335234722978349893182756530411669749306369234364037183085589279552746565653815810160414869246740243261153569914558297323059520013508663819055583506223363378627608242859770430487978537425105943869461178458002429052979010117235631343605106809790800120997526723738724600849164106692721415519037367318542643514658512892595848932100875200979277271668414196566227601970047187483524485460916775091343225734047351997747612977393728801888054835711915265221237848026097305104545179507796215842466329992142779782543184371492666582672674539323755235168953846227986820246041529906311157565060837600624230202531936957236396424648420164804874095388859788317858173016391535121207680768660450546422991544025683929327970026794770662694287819648135149034136905607015652566793475951127339725564741921306844527812535333295431907778001062315012461415006887299858202045982250738289596024493999722632292748305178936032239659283972097371548632238720974049719177696817877569359913761066278554432000443389152585903115616953675852863711818582046914607997227198409141201662124430055943329594261450523662169762091421567028877305198095766078285664064132237430086506470826675205302838467746915860485795371563505272696798085304711468533153453382600367919214296093092987122526280737987477201439749452707732866503465389902319143614395388397053816503438560073867431335545169139629109663649612282121336842488763878862204561736706427621802839397396063064643539098179296621913032387079205892651130710204782067972894714755668218508990884282595654906561504921293588188076250032328041739971229162687825885583746064438060382559836520564913700551515610274169619092501270087410948910848754051931392429543208472327336619543719372792162065749345764253628323548953708101760527561273649708374039388930869180104252536852939711336981771426351377686868069684191413759754289379335182880567734594288054671633195111471813710516341934991229272132818643622562608157006112276654809526623335862250395923684889851783589109616633734674960195083093004283258745013893514306302897719488296856121807383978150643597612075540647157639568024676027275588707630115881198150866989614347913566208411023314426268849763936409806502708262299281930789592302298685602852711499372669303108632509193428337976971821800252284478508015160790710640743736333168674020123476228393837413051945216497314248467783867572790906674873750401171567623263992016144321465747001208215573473344787998149843563602525802046410996673930339430354823996276317658839635591679212540574328133146398921786394994453184171749698005615657787130933155546758861628045596301792203965046956147838824542199523625896055712662734283134722593069787512743637687997212055554808326120959914351485028152980317626117828796592694905549995785241914469262429798262212109324706298275884531556261074100839666320428602932375797324483790087256552110900440164818075430916347097012571906332437055604928605139024567450777898326456122747603424549162054379257756285402037149863763360380989221262229543284270476992898701234838143524679395794726918371047461885110790729296547350306384426428371442011718509916097561422217534290023739620131670221343282701702109278568390178688447420514935017893176356161275478678678446372178359957646669030146765933723310957155541687881114359110246214680483748649792287171047242925032492150683026747672016660676559489762817306683984046083345039834931819233219693322764773297750144
